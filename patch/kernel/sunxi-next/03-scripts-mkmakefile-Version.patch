diff --git a/scripts/mkmakefile b/scripts/mkmakefile
index 412f13fdf..e19d6565f 100755
--- a/scripts/mkmakefile
+++ b/scripts/mkmakefile
@@ -6,20 +6,31 @@
 
 # Usage
 # $1 - Kernel src directory
+# $2 - Output directory
+# $3 - version
+# $4 - patchlevel
 
+
+test ! -r $2/Makefile -o -O $2/Makefile || exit 0
 # Only overwrite automatically generated Makefiles
 # (so we do not overwrite kernel Makefile)
-if test -e Makefile && ! grep -q Automatically Makefile
+if test -e $2/Makefile && ! grep -q Automatically $2/Makefile
 then
 	exit 0
 fi
 if [ "${quiet}" != "silent_" ]; then
-	echo "  GEN     Makefile"
+	echo "  GEN     $2/Makefile"
 fi
 
-cat << EOF > Makefile
+cat << EOF > $2/Makefile
 # Automatically generated by $0: don't edit
 
+VERSION = $3
+PATCHLEVEL = $4
+
+lastword = \$(word \$(words \$(1)),\$(1))
+makedir := \$(dir \$(call lastword,\$(MAKEFILE_LIST)))
+
 ifeq ("\$(origin V)", "command line")
 VERBOSE := \$(V)
 endif
@@ -27,12 +38,15 @@ ifneq (\$(VERBOSE),1)
 Q := @
 endif
 
+MAKEARGS := -C $1
+MAKEARGS += O=\$(if \$(patsubst /%,,\$(makedir)),\$(CURDIR)/)\$(patsubst %/,%,\$(makedir))
+
 MAKEFLAGS += --no-print-directory
 
 .PHONY: __sub-make \$(MAKECMDGOALS)
 
 __sub-make:
-	\$(Q)\$(MAKE) -C $1 O=\$(CURDIR) \$(MAKECMDGOALS)
+	\$(Q)\$(MAKE) \$(MAKEARGS) \$(MAKECMDGOALS)
 
 \$(filter-out __sub-make, \$(MAKECMDGOALS)): __sub-make
 	@:
